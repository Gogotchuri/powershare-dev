var temp = {
    async get(endpoint) {
        return {
            "current_page": 1,
            "data": [{
                    "id": 1,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Help Clean the Hill",
                    "target_audience": "The Villagers",
                    "featured_image_url": "https:\/\/cz-public-images-test.s3.amazonaws.com\/powershare-5YtTOa2JOVkjdl4GvVqOpx23YMsKug1kjg6Y9j50.png"
                },
                {
                    "id": 3,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Help disabled elderly in Armenia",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/cz-public-images-test.s3.amazonaws.com\/powershare-5YtTOa2JOVkjdl4GvVqOpx23YMsKug1kjg6Y9j50.png"
                },
                {
                    "id": 4,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Rescue beautiful mountains in the Caucasus region",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 5,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Save refugees in the Caucasus region",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 6,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Collecting money for unemployed youth in the Caucasus region",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 7,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about poor children on the moon",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 8,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about poor children in the Caucasus region",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 9,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Save army veterans in Europe",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 10,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about beautiful mountains in the United States of America",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 11,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Rescue clean energy in Europe",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 12,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about refugees in The Netherlands",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 13,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Save unemployed youth in the Caucasus region",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/cz-public-images-test.s3.amazonaws.com\/powershare-Vrt4PezCgT5XCHEbf272fTdHNVZgWu7x3tN5BJKm.jpeg"
                },
                {
                    "id": 14,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about clean energy in Armenia",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/cz-public-images-test.s3.amazonaws.com\/powershare-Vrt4PezCgT5XCHEbf272fTdHNVZgWu7x3tN5BJKm.jpeg"
                },
                {
                    "id": 15,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Help clean air in Africa",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                },
                {
                    "id": 16,
                    "category_icon": "iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAYAAABXuSs3AAAAPklEQVR42u3OQQ0AAAgEIE1u9LOEHzdIQKcy9VCLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi19YYNJypVPe1ZgAAAAASUVORK5CYII=",
                    "name": "Why doesn't anyone care about army veterans in the United States of America",
                    "target_audience": null,
                    "featured_image_url": "https:\/\/dummyimage.com\/640x480\/ddd\/888"
                }
            ],
            "first_page_url": "http:\/\/powershare.me\/campaigns?page=1",
            "from": 1,
            "last_page": 8,
            "last_page_url": "http:\/\/powershare.me\/campaigns?page=8",
            "next_page_url": "http:\/\/powershare.me\/campaigns?page=2",
            "path": "http:\/\/powershare.me\/campaigns",
            "per_page": 15,
            "prev_page_url": null,
            "to": 15,
            "total": 111
        };
    }
}

const NUM_CAMPAIGNS_PER_PAGE = 10;

class Campaigns {

    get campaignsHtml(){
        return document.querySelector('.infinite-scroll').querySelector('.row').innerHTML;
    }

    set campaignsHtml(value){
        return document.querySelector('.infinite-scroll').querySelector('.row').innerHTML = value;
    }

    get campaigns() {
        return this.campaigns_;
    }

    set campaigns(campaigns) {
        this.campaigns_ = campaigns;
        this.updateView();
    }

    get loader(){
        return document.querySelector('.loader');
    }

    get infiniteScroll() {
        return document.querySelector('.campaigns-list-wrapper-inner');
    }

    constructor() {
        this.campaigns_ = [];
        document.querySelector('.category-select').onchange = event => this.filterCategory(event);
        document.querySelector('.name-input').oninput = event => this.filterName(event);
        // axios.get('/campaigns').then(result => {
        axios.get('/campaigns').then(result => {
            this.filteredCampaigns = this.sourceCampaigns = result.data.data;
            this.campaigns = this.filteredCampaigns.slice(0, NUM_CAMPAIGNS_PER_PAGE);
        });
        this.infiniteScroll.addEventListener('scroll', () => {
            if (this.infiniteScroll.scrollTop + this.infiniteScroll.clientHeight >= this.infiniteScroll.scrollHeight) {
                this.loadMore();
            }
        });
        this.filter = {
            categoryId: -1,
            name: ''
        }
    }

    filterCategory(e) {
        this.filter.categoryId = e.target.value;
        this.updateFilter();
    }

    filterName(e) {
        this.filter.name = e.target.value;
        this.updateFilter();
    }

    updateFilter() {
        this.infiniteScroll.scrollTo(0,0);
        this.filteredCampaigns = this.sourceCampaigns.filter(campaign => {
            return (this.filter.categoryId == -1 || campaign.category_id == this.filter.categoryId) && campaign.name.toLowerCase().indexOf(this.filter.name.toLowerCase()) != -1;
        });
        this.campaigns = this.filteredCampaigns.slice(0, NUM_CAMPAIGNS_PER_PAGE);
    }

    loadMore(){
        if(this.campaigns.length >= this.filteredCampaigns.length){
            return;
        }
        this.loader.classList.add('show');
        setTimeout(() => {
            this.campaigns.push(...this.filteredCampaigns.slice(this.campaigns.length, this.campaigns.length + NUM_CAMPAIGNS_PER_PAGE));
            this.loader.classList.remove('show');
            this.updateView();
        }, 1000);
    }

    strLimit(str, limit) {
        if(!str){
            return "";
        }
        if (str.length <= limit) {
            return str;
        }
        return str.substr(0, limit - 3) + "...";
    }

    updateView() {
        this.campaignsHtml = this.campaignsView(this.campaigns);
    }

    campaignsView(campaigns) {
        return campaigns.map(campaign => this.campaignView(campaign)).join('');
    }

    campaignView(campaign) {
        return `
            <div class="col-xl-3 col-sm-6 campaign-col">
                <a href="/campaigns/${campaign.id}" class="ps-card">
                    <div class="ps-card-image-container fade">
                <span class="ps-card-icon">
                    <img style="${!campaign.category_icon ? 'display: none;' : ''}" src="data:image/png;base64,${campaign.category_icon}">
                </span>
                        <div class="ps-card-image" style="background-image: url(${campaign.featured_image_url});"></div>
                    </div>

                    <div class="ps-card-description">
                        <h4>
                            ${this.strLimit(campaign.name, 15)}
                        </h4>
                        <p class="ps-card-excerpt">
                            ${this.strLimit(campaign.target_audience, 13)}
                        </p>
                    </div>
                </a>
            </div>
        `;
    }
}

window.addEventListener('load', () => {
    window.campaigns = new Campaigns();
})
